这是处理警犬运动数据的readme

***

1 目前仅仅处理了**跳栅栏**和**跳圈**两种运动

2 对应文件夹为：*1 low jump 1 、5 low height jump 2、6 mid height jump 1、7 high height jump 1、8 ring jump 1、9 ring jump 2*

3 后续处理数据只需要处理后面五个：**1 low jump 1 不管了**

4 **五个坐标系：世界系W、定向Body系wB、Body系bB、髋关节定向系wH、髋关节系bH**

***

最重要的画图函数：
- [x] calculate_angle_copy.m
- [x] virtual_leg.m
- [x] TrajectoryWithJumpPhase.m

# 1 函数功能
## 1 外部脚本
### 1 Angles.m
**绘制并保存每个动作的脊柱角度、角速度、角加速度曲线；髋关节、膝关节以及踝关节的角度、角速度、角加速度**

这里用到的角度是北理郎老师给我们算的结果

### 2 BodyandFoot.m
**绘制8 ring jump 1的四条腿在质心定向坐标系下的曲线、质心位置、速度以及驱赶pitch角曲线**
### 3 CoMwithFootPosition.m
**绘制*fast run and slow walk、prone-stance、low height jump、ring jump 1、ring jump 2*的质心、足端和障碍物位置**

其中障碍物宽度设置成10了
### 4 FootTrajectory.m
**绘制*low height jump、high height jump、ring jump 1、ring jump 2*世界系下足端位置，世界系下X-Z图，质心定向系足端位置、质心定向系X-Z图，髋关节定向系以及髋关节下与世界系同向系下的足端位置、质心定向系X-Z图**
### 5 ring_jump_combine.m
**连接两个跳圈的动作，但是只是把质心的运动连接起来了，腿部是连不起来**
### 6 TrajectoryWithJumpPhase.m  这个是特别长的画图程序
**所有动作的躯干俯仰角（前后两个关节点的连线与x轴的夹角）、质心位置和速度**

**四个坐标系下的足端位置、速度、加速度**
### 7 virtual_leg.m
**绘制所有动作的虚拟腿长度、伸缩速度、加速度，还绘制了左前腿的棍图**

### 8 testRotateAngle.mlx
**测试每一个动作应该旋转的角度**

| 动作  | 角度 |
|------|------|
|1 low jump 1|31*pi/60|
|5 low height jump 2|31*pi/60|
|6 mid height jump 1|-pi/25|
|7 high height jump 1|-pi/16|
|8 ring jump 1|-pi/17|
|9 ring jump 2|-pi/14|
### 9 calculate_spine_length.mlx
计算运动过程中（5 low height jump 2）的头肩长度、两段脊柱长度、两段尾巴长度的平均值
### 10 calculate_angle.m
重新计算警犬的俯仰方向的角度，包括头，脊柱，尾巴与x轴的夹角；腿部的所有角度，其内包含函数绘制背景。

![图片](readmePic\坐标系图.png "矢状面坐标系图")

### 11 calculate_angle_copy.m
calculate_angle.m的副本，但是用函数实现绘制背景，但是需要readme中接触序列的配合才能玩车个绘图。

## 2 内部函数(utilities)
### 1 caculateFOOTVandA.m
**计算足端的速度和加速度**

**输入：**

FOOT----四条腿的足端位置,n*12

detaT----间隔时间

**输出：**

FOOTV-----足端速度（n-1）*12

FOOTA------足端加速度(n-2)*12
### 2 caculateVandA.m
**计算速度和加速度**

**input:** 

data----列向量

detaT----间隔时间

**output：**

v----速度，列向量

a---加速度，列向量
### 3 calculateVirtualLeg.m
**计算虚拟腿长，速度，加速度**

**输入：**   

FOOT---要计算的腿坐标n*3

HIP---------------对应髋关节坐标系n*3

detaT-------------时间间隔1*1

**输出：** 

legLength--------腿长n*3

legVelocity------腿伸缩速度（n-1）*3

legAcceleration--加速度(n-2)*3
### 4 calculateVirtualLegAngle.m
**计算虚拟腿角度，角速度，角加速度，腿与x轴的夹角**

**输入：**   
FOOT---要计算的腿坐标n*3

HIP---------------对应髋关节坐标系n*3

detaT-------------时间间隔1*1

**输出：** 

legAngle--------腿长n*3

legAngularVelocity------腿伸缩速度（n-1）*3

legAngularAcceleration--加速度(n-2)*3
### 5 data_process.m
**处理原始数据：将数据转一个方向，使x方向向前**

**输入：**

raw_data---原始数据

n-----有效数据的行数，再往后取数据不全

angle---将X轴转为奔跑的正方向要转动的角度，根据画出来的结果试出来的

**输出：**

FOOT_wB-----足端在质心定向系下的位置

FOOT_wH-----足端在髋关节定向系下的位置

FOOT_bB-----足端在质心坐标系下的位置

FOOT_bH-----足端在髋关节坐标系下的位置

t---时间

pitch_deg---运动过程中躯干的pitch角

CoM，CoM_dot---质心（中间脊柱）的位置和速度
### 6 data_rotate.m
**处理原始数据：将数据转一个方向，使x方向向前**

**输入：**

raw_data---原始数据

n-----有效数据的行数，再往后取数据不全

angle---将X轴转为奔跑的正方向要转动的角度，根据画出来的结果试出来的

输出：左右前后腿的足端位置（世界系）

FOOT--顺序是左前右前、左后右后 n*12

HIP--顺序是左前右前、左后右后 n*12

t---时间

pitch_deg---运动过程中躯干的pitch角

CoM，CoM_dot---质心（中间脊柱）的位置和速度
### 7 data_rotate_ALL.m
**处理原始数据：将所有的数据都转一个方向，然后输出，使x方向向前**

输入：

raw_data---原始数据

n-----有效数据的行数，再往后取数据不全

angle---将X轴转为奔跑的正方向要转动的角度，根据画出来的结果试出来的

输出：raw_data_rotate----所有的数据旋转了angle后的状态
### 8 PLOT.m
**这个函数是用来自动画图和编辑标题以及坐标的，但是只有一种特定的格式**

**输入**:  

time---时间

data---数据

legname----腿名称

titlename---图题名称
### 9 PLOTJumpPhase.m
**画各腿触地/离地时刻的竖线**

**输入**：

phaseT-----相位开始时间m*1

phaseH-----相位结束时间m*1
### 10 PLOTwithLeg.m
**用于绘制四条腿部的位置，速度，加速度图**

**输入**：

time-------时间向量n*1

data-------腿长、速度、加速度数据n*4

titlename--标题，字符串

ylabelname--y标签，字符串
### 11 PLOTwithPhase.m
**画x,y,z三个方向的位置图，包含有跳跃状态切换的时间**

**输入**：

time-------时间向量n*1

data-------数据n*3
     
titlename--标题，字符串
     
ylabelname--y标签，字符串

phaseT-----相位开始时间m*1

phaseH-----相位结束时间m*1，由于有些切换相位可能没有，所以m是不确定的
### 12 PLOTwithSpineAngle.m
**用于绘制脊柱角度，角速度，角加速度图**

**输入**：

time-------时间向量n*1

data-------柱角度，角速度，角加速数据n*1
     
titlename--标题，字符串
     
ylabelname--y标签，字符串

### 13 rx.m
计算绕x轴旋转一定角度的旋转矩阵

**输入**：角度

**输出**：旋转矩阵
### 14 ry.m
计算绕y轴旋转一定角度的旋转矩阵

**输入**：角度

**输出**：旋转矩阵
### 15 rz.m
计算绕z轴旋转一定角度的旋转矩阵

**输入**：角度

**输出**：旋转矩阵
### 16 PLOTLegBackground.m

绘制单腿相位背景

**输入**：
T——包含触地结束（腾空开始）、腾空结束（触地开始）、触地开始（腾空开始）、腾空结束（触地开始）时刻数据，并且一直按照这个顺序输入。没有的数据就用-1表示

X——要画的图的x方向的数值，一般是xlim_values

Y——要画的图的y方向的数值，一般是ylim_values

### 17 PLOTBodyBackground.m

画机身相位背景

**输入**：
T——包含起跳开始、触地结束（腾空开始）、腾空结束（触地开始）、触地开始（腾空开始）、腾空结束（触地开始）时刻数据，并且一直按照这个顺序输入。没有的数据就用-1表示

X——要画的图的x方向的数值，一般是xlim_values

Y——要画的图的y方向的数值，一般是ylim_values
# 2 标定每个动作的触地时间、离地时间

单位：s 

-1表示没有这个数据

-2表示数据是图窗的左极限

-3表示数据是图窗的右极限

**表示分割表格

|动作|5 low height jump 2|6 mid height jump 1|7 high height jump 1|8 ring jump 1|9 ring jump 2|
|-|-|-|-|-|-
|开始时间|2.375|2.658|2.583|2.6|2.517|
|结束时间|2.758|3.2|3.042|3.05|2.883|
|**|
|**起跳开始**|-2|-2|-2|-2|-1
|起跳结束（腾空开始）|2.483|2.883|2.725|2.767|-2
|**腾空结束（落地开始）**|-3|3.183|-3|-3|2.75
|落地结束|-1|-3|-1|-1|-3
|**|
|左前腿触地结束（腾空开始）|-1|-2|-1|-1|-2|
|**左前腿腾空结束（触地开始）**|-2|2.708|-2|-2|2.750|
|左前腿触地结束（腾空开始）|2.4|2.792|2.642|2.650|2.842|
|**左前腿腾空结束（触地开始）**|-3|3.183|-3|-3|-3|
|左后腿触地结束（腾空开始）|-1|-3|-1|-1|-1|
|**|
|右前腿触地结束（腾空开始）|-2|-1|-1|-1|-2|
|**右前腿腾空结束（触地开始）**|-3|-2|-2|-2|2.758|
|右前腿触地结束（腾空开始）|-1|2.742|2.625|2.683|2.858
|**右前腿腾空结束（触地开始）**|-1|-3|-3|-3|-3|
|**|
|左后腿触地结束（腾空开始）|-2|-1|-2|-2|-2|
|**左后腿腾空结束（触地开始）**|2.408|-2|2.633|2.683|-3
|左后腿触地结束（腾空开始）|2.483|2.692|2.725|2.767|-1
|**左后腿腾空结束（触地开始）**|-3|2.8|-3|-3|-1
|左后腿触地结束（腾空开始）|-1|2.883|-1|-1|-1|
|**左后腿腾空结束（触地开始）**|-1|-3|-1|-1|-1|
|**|
|右后腿触地结束（腾空开始）|-2|-2|-2|-2|-2|
|**右后腿腾空结束（触地开始）**|2.4|2.758|2.625|2.667|2.825
|右后腿触地结束（腾空开始）|2.467|2.858|2.717|2.758|-3|
|**右后腿腾空结束（触地开始）**|-3|-3|-3|-3|-1|

# 3 两段脊柱长度
- 前脊柱长度（length_spine_front_avg）：0.1699m/0.2172m

- 后脊柱长度（length_spine_hind_avg）：0.2524m/0.3227m

- 头到前脊柱长度（length_head_avg）：0.3146m

- 尾巴1长度（length_tail_1_avg）：0.1753m

- 尾巴2长度（length_tail_2_avg）：0.0688m




















